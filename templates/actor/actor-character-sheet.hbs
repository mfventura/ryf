<form class="{{cssClass}} flexcol" autocomplete="off">

  <header class="sheet-header">
    <img class="profile-img" src="{{actor.img}}" data-edit="img" title="{{actor.name}}" height="100" width="100"/>
    
    <div class="header-fields">
      <h1 class="charname"><input name="name" type="text" value="{{actor.name}}" placeholder="{{localize 'RYF.CharacterName'}}"/></h1>
      
      <div class="combat-status-indicators">
        {{#if system.states.dead}}
        <div class="status-indicator dead">
          <i class="fas fa-skull"></i>
          <strong>{{localize "RYF.States.Dead"}}</strong>
        </div>
        {{else if system.states.unconscious}}
        <div class="status-indicator unconscious">
          <i class="fas fa-dizzy"></i>
          <strong>{{localize "RYF.States.unconscious"}}</strong>
        </div>
        {{else if system.states.wounded}}
        <div class="status-indicator wounded">
          <i class="fas fa-heart-broken"></i>
          <strong>{{localize "RYF.States.wounded"}}</strong>
          <span class="status-effect">({{localize "RYF.Combat.AutoDisadvantage"}})</span>
        </div>
        {{/if}}
      </div>

      <div class="resources grid grid-2col">
        <div class="resource">
          <label class="resource-label">{{localize "RYF.Health"}}</label>
          <div class="resource-content flexrow">
            <input type="text" name="system.health.value" value="{{system.health.value}}" data-dtype="Number"/>
            <span class="sep"> / </span>
            <span class="resource-max">{{system.health.max}}</span>
          </div>
        </div>

        {{#if isMagicEnabled}}
        <div class="resource">
          <label class="resource-label">{{localize "RYF.Mana"}}</label>
          <div class="resource-content flexrow">
            <input type="text" name="system.mana.value" value="{{system.mana.value}}" data-dtype="Number"/>
            <span class="sep"> / </span>
            <span class="resource-max">{{system.mana.max}}</span>
          </div>
        </div>
        {{/if}}

        <div class="resource">
          <label class="resource-label">{{localize "RYF.Defense"}}</label>
          <div class="resource-content">
            <span class="resource-value">{{system.defense.value}}</span>
          </div>
        </div>

        <div class="resource">
          <label class="resource-label">{{localize "RYF.Initiative"}}</label>
          <div class="resource-content">
            <span class="resource-value">{{system.initiative.value}}</span>
          </div>
        </div>

        {{#if isCarismaEnabled}}
        <div class="resource">
          <label class="resource-label">{{localize "RYF.Willpower"}}</label>
          <div class="resource-content">
            <span class="resource-value">{{system.willpower.value}}</span>
          </div>
        </div>
        {{/if}}
      </div>

      <div class="combat-modifiers">
        {{#if (gt system.combat.hindrance 0)}}
        <div class="modifier hindrance">
          <i class="fas fa-weight-hanging"></i>
          <span>{{localize "RYF.Hindrance"}}: {{system.combat.hindrance}}</span>
        </div>
        {{/if}}

        {{#if (gt system.combat.absorption 0)}}
        <div class="modifier absorption">
          <i class="fas fa-shield-alt"></i>
          <span>{{localize "RYF.Combat.Absorption"}}: {{system.combat.absorption}}</span>
        </div>
        {{/if}}
      </div>

      <div class="experience-bar">
        <div class="flexrow" style="justify-content: space-between; align-items: center; margin-bottom: 5px;">
          <label>{{localize "RYF.Experience"}}: {{system.experience.current}} / {{system.experience.total}}</label>
          <button type="button" class="add-experience" style="padding: 3px 8px; font-size: 12px;">
            <i class="fas fa-plus"></i> {{localize "RYF.AddExperience"}}
          </button>
        </div>
        <div class="progress-bar">
          <div class="progress-fill" style="width: 100%;"></div>
        </div>
      </div>
    </div>
  </header>

  <nav class="sheet-tabs tabs" data-group="primary">
    <a class="item" data-tab="attributes">{{localize "RYF.Tabs.Attributes"}}</a>
    <a class="item" data-tab="skills">{{localize "RYF.Tabs.Skills"}}</a>
    <a class="item" data-tab="combat">{{localize "RYF.Tabs.Combat"}}</a>
    {{#if isMagicEnabled}}
    <a class="item" data-tab="magic">{{localize "RYF.Tabs.Magic"}}</a>
    {{/if}}
    <a class="item" data-tab="effects">{{localize "RYF.Tabs.Effects"}}</a>
    <a class="item" data-tab="equipment">{{localize "RYF.Tabs.Equipment"}}</a>
    <a class="item" data-tab="biography">{{localize "RYF.Tabs.Biography"}}</a>
  </nav>

  <section class="sheet-body">

    <div class="tab attributes" data-group="primary" data-tab="attributes">
      <div class="attributes-header">
        <h3>{{localize "RYF.Tabs.Attributes"}}</h3>
        <div class="attribute-points">
          <label>{{localize "RYF.AttributePoints"}}: </label>
          <span class="points-used">{{system.attributePoints.used}}</span>
          <span> / </span>
          <span class="points-max">{{system.attributePoints.max}}</span>
          <span class="points-remaining">({{localize "RYF.Remaining"}}: {{attributePointsRemaining}})</span>
        </div>
      </div>

      <div class="attributes-list">
        <div class="attribute flexrow">
          <label class="attribute-label">{{localize "RYF.Attributes.Fisico"}}</label>
          <input type="number" class="attribute-input" name="system.attributes.fisico.value" value="{{system.attributes.fisico.value}}" data-attribute="fisico" data-dtype="Number" min="1" max="20"/>
        </div>
        <div class="attribute flexrow">
          <label class="attribute-label">{{localize "RYF.Attributes.Destreza"}}</label>
          <input type="number" class="attribute-input" name="system.attributes.destreza.value" value="{{system.attributes.destreza.value}}" data-attribute="destreza" data-dtype="Number" min="1" max="20"/>
        </div>
        <div class="attribute flexrow">
          <label class="attribute-label">{{localize "RYF.Attributes.Inteligencia"}}</label>
          <input type="number" class="attribute-input" name="system.attributes.inteligencia.value" value="{{system.attributes.inteligencia.value}}" data-attribute="inteligencia" data-dtype="Number" min="1" max="20"/>
        </div>
        <div class="attribute flexrow">
          <label class="attribute-label">{{localize "RYF.Attributes.Percepcion"}}</label>
          <input type="number" class="attribute-input" name="system.attributes.percepcion.value" value="{{system.attributes.percepcion.value}}" data-attribute="percepcion" data-dtype="Number" min="1" max="20"/>
        </div>
        {{#if isCarismaEnabled}}
        <div class="attribute flexrow">
          <label class="attribute-label">{{localize "RYF.Attributes.Carisma"}}</label>
          <input type="number" class="attribute-input" name="system.attributes.carisma.value" value="{{system.attributes.carisma.value}}" data-attribute="carisma" data-dtype="Number" min="1" max="20"/>
        </div>
        {{/if}}
      </div>

      <div class="derived-stats">
        <h3>{{localize "RYF.DerivedStats"}}</h3>
        <div class="stat-row">
          <label>{{localize "RYF.State"}}: </label>
          <span class="state-value {{characterState}}">{{localize (concat "RYF.States." characterState)}}</span>
        </div>
      </div>

      <div class="rest-buttons flexrow">
        <button type="button" class="short-rest">{{localize "RYF.ShortRest"}}</button>
        <button type="button" class="long-rest">{{localize "RYF.LongRest"}}</button>
      </div>
    </div>

    <div class="tab skills" data-group="primary" data-tab="skills">
      <div class="skills-header flexrow">
        <h3>{{localize "RYF.Tabs.Skills"}}</h3>
        <a class="item-create" data-type="skill"><i class="fas fa-plus"></i> {{localize "RYF.AddSkill"}}</a>
      </div>

      {{#if hasSkills}}
        {{#if pyramidValidation.valid}}
        <div class="pyramid-valid">
          <i class="fas fa-check-circle"></i> {{localize "RYF.PyramidValid"}}
        </div>
        {{else}}
        <div class="pyramid-invalid">
          <i class="fas fa-exclamation-triangle"></i> {{localize "RYF.PyramidInvalid"}}
          <ul>
            {{#each pyramidValidation.errors as |error|}}
            <li>{{error.message}}</li>
            {{/each}}
          </ul>
        </div>
        {{/if}}
      {{/if}}

      <ol class="items-list skill-list">
        <li class="item flexrow item-header">
          <div class="item-name">{{localize "RYF.SkillName"}}</div>
          <div class="item-attribute">{{localize "RYF.Attribute"}}</div>
          <div class="item-level">{{localize "RYF.Level"}}</div>
          <div class="item-controls">{{localize "RYF.Controls"}}</div>
        </li>

        {{#each skills as |item id|}}
        <li class="item flexrow" data-item-id="{{item._id}}">
          <div class="item-name">
            <div class="item-image"><img src="{{item.img}}" title="{{item.name}}" width="24" height="24"/></div>
            <h4>{{item.name}}</h4>
          </div>
          <div class="item-attribute">{{localize (lookup ../config.attributes item.system.attribute)}}</div>
          <div class="item-level">
            <a class="skill-decrease" title="{{localize 'RYF.DecreaseLevel'}}"><i class="fas fa-minus"></i></a>
            <span class="level-value">{{item.system.level}}</span>
            <a class="skill-increase" title="{{localize 'RYF.IncreaseLevel'}}"><i class="fas fa-plus"></i></a>
          </div>
          <div class="item-controls">
            <a class="item-control skill-roll" title="{{localize 'RYF.Roll'}}"><i class="fas fa-dice-d20"></i></a>
            <a class="item-control item-edit" title="{{localize 'RYF.Edit'}}"><i class="fas fa-edit"></i></a>
            <a class="item-control item-delete" title="{{localize 'RYF.Delete'}}"><i class="fas fa-trash"></i></a>
          </div>
        </li>
        {{/each}}
      </ol>
    </div>

    <div class="tab combat" data-group="primary" data-tab="combat">
      <div class="weapons-section">
        <div class="items-header flexrow">
          <h3>{{localize "RYF.Weapons"}}</h3>
          <a class="item-create" data-type="weapon"><i class="fas fa-plus"></i> {{localize "RYF.AddWeapon"}}</a>
        </div>

        <ol class="items-list">
          <li class="item flexrow item-header">
            <div class="item-name">{{localize "RYF.WeaponName"}}</div>
            <div class="item-damage">{{localize "RYF.Damage"}}</div>
            <div class="item-roll"></div>
            <div class="item-controls">{{localize "RYF.Controls"}}</div>
          </li>

          {{#each weapons as |item id|}}
          <li class="item flexrow" data-item-id="{{item._id}}">
            <div class="item-name">
              <div class="item-image"><img src="{{item.img}}" title="{{item.name}}" width="24" height="24"/></div>
              <h4>{{item.name}}</h4>
            </div>
            <div class="item-damage">{{item.system.damage.base}}</div>
            <div class="item-roll">
              {{#if item.system.equipped}}
              <a class="item-control item-attack" title="{{localize 'RYF.Attack'}}" data-item-id="{{item._id}}">
                <i class="fas fa-dice-d20"></i>
              </a>
              {{/if}}
            </div>
            <div class="item-controls">
              <input type="checkbox" {{checked item.system.equipped}} class="item-toggle" title="{{localize 'RYF.Equipped'}}"/>
              <a class="item-control item-edit" title="{{localize 'RYF.Edit'}}"><i class="fas fa-edit"></i></a>
              <a class="item-control item-delete" title="{{localize 'RYF.Delete'}}"><i class="fas fa-trash"></i></a>
            </div>
          </li>
          {{/each}}
        </ol>
      </div>

      <div class="armor-section">
        <div class="items-header flexrow">
          <h3>{{localize "RYF.Armor"}}</h3>
          <a class="item-create" data-type="armor"><i class="fas fa-plus"></i> {{localize "RYF.AddArmor"}}</a>
        </div>

        <ol class="items-list">
          <li class="item flexrow item-header">
            <div class="item-name">{{localize "RYF.ArmorName"}}</div>
            <div class="item-protection">{{localize "RYF.Protection"}}</div>
            <div class="item-hindrance">{{localize "RYF.Hindrance"}}</div>
            <div class="item-controls">{{localize "RYF.Controls"}}</div>
          </li>

          {{#each armor as |item id|}}
          <li class="item flexrow" data-item-id="{{item._id}}">
            <div class="item-name">
              <div class="item-image"><img src="{{item.img}}" title="{{item.name}}" width="24" height="24"/></div>
              <h4>{{item.name}}</h4>
            </div>
            <div class="item-protection">{{item.system.protection}}</div>
            <div class="item-hindrance">{{item.system.hindrance}}</div>
            <div class="item-controls">
              <input type="checkbox" {{checked item.system.equipped}} class="item-toggle" title="{{localize 'RYF.Equipped'}}"/>
              <a class="item-control item-edit" title="{{localize 'RYF.Edit'}}"><i class="fas fa-edit"></i></a>
              <a class="item-control item-delete" title="{{localize 'RYF.Delete'}}"><i class="fas fa-trash"></i></a>
            </div>
          </li>
          {{/each}}
        </ol>
      </div>

      <div class="shields-section">
        <div class="items-header flexrow">
          <h3>{{localize "RYF.Shields"}}</h3>
          <a class="item-create" data-type="shield"><i class="fas fa-plus"></i> {{localize "RYF.AddShield"}}</a>
        </div>

        <ol class="items-list">
          <li class="item flexrow item-header">
            <div class="item-name">{{localize "RYF.ShieldName"}}</div>
            <div class="item-defense-melee">{{localize "RYF.DefenseMeleeShort"}}</div>
            <div class="item-defense-ranged">{{localize "RYF.DefenseRangedShort"}}</div>
            <div class="item-hindrance">{{localize "RYF.Hindrance"}}</div>
            <div class="item-controls">{{localize "RYF.Controls"}}</div>
          </li>

          {{#each shields as |item id|}}
          <li class="item flexrow" data-item-id="{{item._id}}">
            <div class="item-name">
              <div class="item-image"><img src="{{item.img}}" title="{{item.name}}" width="24" height="24"/></div>
              <h4>{{item.name}}</h4>
            </div>
            <div class="item-defense-melee">{{item.system.defense.melee}}</div>
            <div class="item-defense-ranged">{{item.system.defense.ranged}}</div>
            <div class="item-hindrance">{{item.system.hindrance}}</div>
            <div class="item-controls">
              <input type="checkbox" {{checked item.system.equipped}} class="item-toggle" title="{{localize 'RYF.Equipped'}}"/>
              <a class="item-control item-edit" title="{{localize 'RYF.Edit'}}"><i class="fas fa-edit"></i></a>
              <a class="item-control item-delete" title="{{localize 'RYF.Delete'}}"><i class="fas fa-trash"></i></a>
            </div>
          </li>
          {{/each}}
        </ol>
      </div>
    </div>

    {{#if isMagicEnabled}}
    <div class="tab magic" data-group="primary" data-tab="magic">
      <div class="spells-header flexrow">
        <h3>{{localize "RYF.Spells"}}</h3>
        <a class="item-create" data-type="spell"><i class="fas fa-plus"></i> {{localize "RYF.AddSpell"}}</a>
      </div>

      {{#if hasSpells}}
        {{#if pyramidValidation.valid}}
        <div class="pyramid-valid">
          <i class="fas fa-check-circle"></i> {{localize "RYF.PyramidValid"}}
        </div>
        {{else}}
        <div class="pyramid-invalid">
          <i class="fas fa-exclamation-triangle"></i> {{localize "RYF.PyramidInvalid"}}
          <ul>
            {{#each pyramidValidation.errors as |error|}}
            <li>{{error.message}}</li>
            {{/each}}
          </ul>
        </div>
        {{/if}}
      {{/if}}

      <ol class="items-list spell-list">
        <li class="item flexrow item-header">
          <div class="item-name">{{localize "RYF.SpellName"}}</div>
          <div class="item-school">{{localize "RYF.School"}}</div>
          <div class="item-level">{{localize "RYF.Level"}}</div>
          <div class="item-mana">{{localize "RYF.ManaCost"}}</div>
          <div class="item-controls">{{localize "RYF.Controls"}}</div>
        </li>

        {{#each spells as |item id|}}
        <li class="item flexrow" data-item-id="{{item._id}}">
          <div class="item-name">
            <div class="item-image"><img src="{{item.img}}" title="{{item.name}}" width="24" height="24"/></div>
            <h4>{{item.name}}</h4>
          </div>
          <div class="item-school">{{localize (concat "RYF.Schools." (capitalize item.system.school))}}</div>
          <div class="item-level">
            <a class="skill-decrease" title="{{localize 'RYF.DecreaseLevel'}}"><i class="fas fa-minus"></i></a>
            <span class="level-value">{{item.system.level}}</span>
            <a class="skill-increase" title="{{localize 'RYF.IncreaseLevel'}}"><i class="fas fa-plus"></i></a>
          </div>
          <div class="item-mana">{{item.system.manaCost}}</div>
          <div class="item-controls">
            <a class="item-control spell-cast" title="{{localize 'RYF.Cast'}}"><i class="fas fa-magic"></i></a>
            <a class="item-control item-edit" title="{{localize 'RYF.Edit'}}"><i class="fas fa-edit"></i></a>
            <a class="item-control item-delete" title="{{localize 'RYF.Delete'}}"><i class="fas fa-trash"></i></a>
          </div>
        </li>
        {{/each}}
      </ol>
    </div>
    {{/if}}

    <div class="tab effects" data-group="primary" data-tab="effects">
      <div class="items-header flexrow">
        <h3>{{localize "RYF.Magic.ActiveEffects"}}</h3>
      </div>

      {{#if activeEffects}}
      <ol class="items-list">
        <li class="item flexrow item-header">
          <div class="effect-type">{{localize "RYF.Type"}}</div>
          <div class="item-name">{{localize "RYF.Source"}}</div>
          <div class="effect-target-type">{{localize "RYF.Target"}}</div>
          <div class="effect-target-value">{{localize "RYF.TargetValue"}}</div>
          <div class="effect-modifier-header">{{localize "RYF.Modifier"}}</div>
          <div class="effect-duration">{{localize "RYF.Duration"}}</div>
          <div class="item-controls">{{localize "RYF.Controls"}}</div>
        </li>

        {{#each activeEffects as |effect id|}}
        <li class="item flexrow" data-effect-id="{{effect._id}}">
          <div class="effect-type">
            {{#if (eq effect.sourceType "spell")}}
              {{localize "RYF.Spell"}}
            {{else if (eq effect.sourceType "item")}}
              {{localize "RYF.Item"}}
            {{else if (eq effect.sourceType "condition")}}
              {{localize "RYF.Condition"}}
            {{else if (eq effect.sourceType "other")}}
              {{localize "RYF.Effect"}}
            {{else}}
              {{localize "RYF.Unknown"}}
            {{/if}}
          </div>
          <div class="item-name">
            <div class="item-image"><img src="{{effect.icon}}" title="{{effect.sourceName}}" width="24" height="24"/></div>
            <h4>{{effect.sourceName}}</h4>
          </div>
          <div class="effect-target-type">
            {{#if (eq effect.targetType "condition")}}
              {{localize "RYF.StatusEffect"}}
            {{else if (eq effect.targetType "other")}}
              {{localize "RYF.Custom"}}
            {{else}}
              {{localize (concat "RYF.Magic.EffectTargets." (targetToPascalCase effect.targetType))}}
            {{/if}}
          </div>
          <div class="effect-target-value">
            {{#if effect.targetName}}
              {{#if (eq effect.targetType "attribute")}}
                {{localize (concat "RYF.Attributes." (capitalize effect.targetName))}}
              {{else}}
                {{effect.targetName}}
              {{/if}}
            {{else}}
              -
            {{/if}}
          </div>
          <div class="effect-modifier {{#if (gt effect.modifier 0)}}positive{{else}}negative{{/if}}">
            {{#if (gt effect.modifier 0)}}+{{/if}}{{effect.modifier}}
          </div>
          <div class="effect-duration">
            {{#if effect.isTemporary}}
              <div class="duration-bar">
                <div class="duration-fill" style="width: {{multiply (divide effect.durationRemaining effect.durationTotal) 100}}%"></div>
              </div>
              <span class="duration-text">{{effect.durationRemaining}}/{{effect.durationTotal}}</span>
            {{else}}
              <span class="duration-text">{{localize "RYF.Permanent"}}</span>
            {{/if}}
          </div>
          <div class="item-controls">
            <a class="item-control effect-toggle" data-effect-id="{{effect._id}}" title="{{localize 'RYF.Toggle'}}">
              {{#if effect.disabled}}
              <i class="fas fa-eye-slash"></i>
              {{else}}
              <i class="fas fa-eye"></i>
              {{/if}}
            </a>
            <a class="item-control effect-remove" data-effect-id="{{effect._id}}" title="{{localize 'RYF.Remove'}}"><i class="fas fa-times"></i></a>
          </div>
        </li>
        {{/each}}
      </ol>
      {{else}}
      <p class="no-effects">{{localize "RYF.Magic.NoActiveEffects"}}</p>
      {{/if}}
    </div>

    <div class="tab equipment" data-group="primary" data-tab="equipment">
      <div class="equipment-header flexrow">
        <h3>{{localize "RYF.Equipment"}}</h3>
        <a class="item-create" data-type="equipment"><i class="fas fa-plus"></i> {{localize "RYF.AddEquipment"}}</a>
      </div>

      <ol class="items-list">
        {{#each equipment as |item id|}}
        <li class="item flexrow" data-item-id="{{item._id}}">
          <div class="item-name">
            <div class="item-image"><img src="{{item.img}}" title="{{item.name}}" width="24" height="24"/></div>
            <h4>{{item.name}}</h4>
          </div>
          <div class="item-quantity">{{localize "RYF.Quantity"}}: {{item.system.quantity}}</div>
          <div class="item-equipped">
            <input type="checkbox" {{checked item.system.equipped}} class="item-toggle"/>
          </div>
          <div class="item-controls">
            <a class="item-control item-edit" title="{{localize 'RYF.Edit'}}"><i class="fas fa-edit"></i></a>
            <a class="item-control item-delete" title="{{localize 'RYF.Delete'}}"><i class="fas fa-trash"></i></a>
          </div>
        </li>
        {{/each}}
      </ol>
    </div>

    <div class="tab biography" data-group="primary" data-tab="biography">
      <div class="editor-content">
        {{editor system.biography target="system.biography" button=true owner=owner editable=editable}}
      </div>
    </div>

  </section>
</form>

